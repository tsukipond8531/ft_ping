#include "utils.h"
#include <assert.h>

void utils_compute_checksum(void) {
  {
    char bytes[20] = {0x45, 0x00, 0x00, 0x73, 0x00, 0x00, 0x40,
                      0x00, 0x40, 0x11, 0x00, 0x00, 0xc0, 0xa8,
                      0x00, 0x01, 0xc0, 0xa8, 0x00, 0xc7};
    uint16_t checksum = compute_checksum(bytes, 20);

    assert(checksum == 0xb861);
  }
  {
    char bytes[20] = {0x45, 0x00, 0x00, 0x54, 0x20, 0xb8, 0x00,
                      0x00, 0x40, 0x01, 0x00, 0x00, 0xc0, 0xa8,
                      0x00, 0x50, 0xac, 0xd9, 0x10, 0x8e};
    uint16_t checksum = compute_checksum(bytes, 20);

    assert(checksum == 0xdb91);
  }
  {

    char bytes[20] = {0x45, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00,
                      0x00, 0x72, 0x01, 0x00, 0x00, 0xac, 0xd9,
                      0x10, 0x8e, 0xc0, 0xa8, 0x00, 0x50};
    uint16_t checksum = compute_checksum(bytes, 20);

    assert(checksum == 0xca49);
  }
  {

    char bytes[20] = {0x45, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00,
                      0x00, 0x72, 0x02, 0x00, 0x00, 0xac, 0xd9,
                      0x10, 0x8e, 0xc0, 0xa8, 0x00, 0x50};
    uint16_t checksum = compute_checksum(bytes, 20);

    assert(checksum != 0xca49);
  }
}

void utils_is_valid_checksum(void) {
  {
    char bytes[20] = {0x45, 0x00, 0x00, 0x73, 0x00, 0x00, 0x40,
                      0x00, 0x40, 0x11, 0xb8, 0x61, 0xc0, 0xa8,
                      0x00, 0x01, 0xc0, 0xa8, 0x00, 0xc7};

    assert(is_valid_checksum(bytes, 20));
  }
  {
    char bytes[20] = {0x45, 0x00, 0x00, 0x54, 0x20, 0xb8, 0x00,
                      0x00, 0x40, 0x01, 0xdb, 0x91, 0xc0, 0xa8,
                      0x00, 0x50, 0xac, 0xd9, 0x10, 0x8e};

    assert(is_valid_checksum(bytes, 20));
  }
  {

    char bytes[20] = {0x45, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00,
                      0x00, 0x72, 0x01, 0xca, 0x49, 0xac, 0xd9,
                      0x10, 0x8e, 0xc0, 0xa8, 0x00, 0x50};

    assert(is_valid_checksum(bytes, 20));
  }
  {

    char bytes[20] = {0x45, 0x00, 0x00, 0x54, 0x00, 0x00, 0x00,
                      0x00, 0x72, 0x01, 0xcb, 0x49, 0xac, 0xd9,
                      0x10, 0x8e, 0xc0, 0xa8, 0x00, 0x50};

    assert(!is_valid_checksum(bytes, 20));
  }
}

int main(void) {
  utils_compute_checksum();
  utils_is_valid_checksum();
}
